<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.1.3/dist/css/bootstrap.min.css" rel="stylesheet"
        integrity="sha384-1BmE4kWBq78iYhFldvKuhfTAU6auU8tT94WrHftjDbrCEXSU1oBoqyl2QvZ6jIW3" crossorigin="anonymous">
    <title>Document</title>
    <style>
        td {
            padding: 10px;
            background-color: crimson;
            color: white;
            border-radius: 3px;
        }

        /* p {
            margin-top: 120px;
            color: blue;
            font-size: 30px;
        } */

        h4 {
            color: rgb(0, 0, 0);
            font-size: 20px !important;
            margin-bottom: 50px;
        }

        tr {
            margin-bottom: 10px;
        }

        #table {
            display: grid;
            grid-template-columns: repeat(3, 180px);
        }

        .table-container {
            display: flex;
            justify-content: center;
        }

        body {
            background-color: Seashell;
        }
    </style>
</head>

<body>
    <div class="container mt-3 p-4 bg-dark rounded-3 mb-5 mt-5">
        <p class="text-white fs-4 text-center mb-4">Average Weighted Filter, Mean Filter & Image Cross Correlation
            Finder</p>
        <div class="d-flex gap-3 mb-3">
            <input type="number" class="form-control w-25" name="" id="m" placeholder="Enter number of rows">
            <input type="number" class="form-control w-25" name="" id="n" placeholder="Enter number of columns">
        </div>
        <select class="form-select w-25 mb-3" aria-label="Default select example" name="" id="selectedFilter">
            <option value="Mean" selected disabled>Select your Filter</option>
            <option value="Mean">Mean Filter</option>
            <option value="Weighted">Weighted Average Filter</option>
            <option value="CrossCorrelation">Cross Correlation</option>
        </select>

        <input class="form-control" type="text" name="" id="numberInput"
            placeholder="Enter your image.. separated by comma"> <br>
        <input class="form-control" type="text" name="" id="filter" placeholder="Enter your filter"> <br>
        <button class="btn btn-danger d-block mx-auto w-25" id="btn">Submit</button>
    </div>
    <div class="table-container">
        <div>
            <table id="table"></table>
        </div>
    </div>

    <script>

        let image = [];
        let filter = [];
        document.getElementById('filter').style.display = 'none';


        //event handler
        document.getElementById('selectedFilter').addEventListener('click', () => {
            const selectedFilter = document.getElementById('selectedFilter').value;

            if (selectedFilter === 'CrossCorrelation') {
                document.getElementById('filter').style.display = 'block';
                filter = [];
            }
            else if (selectedFilter === 'Weighted') {
                filter = [0.0625, 0.125, 0.0625, 0.125, 0.25, 0.125, 0.0625, 0.125, 0.0625];
                document.getElementById('filter').style.display = 'none';
            }
            else if (selectedFilter === 'Mean') {
                filter = [0.11111111111, 0.11111111111, 0.11111111111, 0.11111111111, 0.11111111111, 0.11111111111, 0.11111111111, 0.11111111111, 0.11111111111];
                document.getElementById('filter').style.display = 'none';
            }
            else {
                filter = [];
            }
        })

        //event handler
        document.getElementById('btn').addEventListener('click', () => {
            let array = [];
            const numberImage = document.getElementById('numberInput').value;
            const numberFilter = document.getElementById('filter').value;
            const mString = document.getElementById('m').value;
            const nString = document.getElementById('n').value;
            const stringImage = numberImage.split(',');
            const stringFilter = numberFilter.split(',');
            const table = document.getElementById('table');
            const filterField = document.getElementById('filter');
            const result = document.getElementById('result');
            const selectedFilter = document.getElementById('selectedFilter').value;


            table.innerHTML = '';
            

            // if (selectedFilter === 'Mean') {
            //     document.getElementById('filter').style.display = 'none';
            // }
            // else if (selectedFilter === 'Weighted') {
            //     document.getElementById('filter').style.display = 'none';
            // }
            // if(selectedFilter === 'Mean'){
            //     document.getElementById('filter').style.display = 'none';
            // }




            //image & filter
            //     const image = [
            //     91, 253, 253, 0, 252, 4, 254, 129, 12, 7, 7, 3, 53, 7, 252, 5, 5, 87, 133, 205, 29, 4, 5, 5, 252, 252, 252, 78, 18, 13
            // ];
            // const filter = [252, 29, 1, 29, 4, 5, 252, 78, 18];

            for (let i = 0; i < stringImage.length; i++) {
                image[i] = parseFloat(stringImage[i]);
            }

            if (selectedFilter === 'CrossCorrelation') {
                for (let i = 0; i < stringFilter.length; i++) {
                    filter[i] = parseFloat(stringFilter[i]);
                }
            }
            if(numberFilter === ''){
                alert('Filter cannot be empty..');
                return;
            }
            if(filter.length != 9){
                alert('Your filter length should be 9');
                return;
            }




            //updated
            let m = parseInt(mString);
            let n = parseInt(nString);

            let x = 0;
            let y = 1;
            let z = 2;
            let loop = ((m * n) - ((n * 2) + ((m - 2) * 2)));
            let newImage = [];
            let trackIndex = [0, 1, 2];

            for (let i = 0; i < loop; i++) {
                for (let i = 0; i < 6; i++) {
                    let res = trackIndex[i] + n;
                    trackIndex.push(res);
                }

                for (let i = 0; i < image.length; i++) {
                    if (trackIndex[i] || trackIndex[i] == 0) {
                        let x = image[trackIndex[i]];
                        const tr = document.createElement('tr');
                        tr.innerHTML = `
                <td>${x}</td>
                `;
                        table.appendChild(tr);
                        newImage.push(x);
                    }
                }

                let sum = 0;
                for (let i = 0; i < newImage.length; i++) {
                    let result = newImage[i] * filter[i];
                    sum += result;
                }
                const h4 = document.createElement('h4');
                const span = document.createElement('span');
                const span2 = document.createElement('span');
                h4.innerHTML = `Result = ${sum} <br>`;
                table.appendChild(h4);
                table.appendChild(span);
                table.appendChild(span2);
                for (let i = 0; i < 9; i++) {
                    trackIndex.pop();
                    newImage.pop();
                }
                x++;
                y++;
                z++;
                trackIndex.push(x);
                trackIndex.push(y);
                trackIndex.push(z);
                console.log(trackIndex);

                ///increment index

                let k = (n - 1);
                //if not work back to handcore.
                // if (z == 6 || z == 13 || z == 20 || z == 27 || z == 34) {
                //     x += 2;
                //     y += 2;
                //     z += 2;
                // }
                if (z == k || z == k * 2 + 1 || z == k * 3 + 2 || z == k * 4 + 3 || z == k * 5 + 4) {
                    x += 2;
                    y += 2;
                    z += 2;
                }

            }
        })

        //change image, filter, m, n && increment index.
        // const image = [
        //     0, 0, 0, 0, 0, 0, 0, 0, 73, 73, 73, 0, 0, 0, 0, 74, 57, 54, 3, 7, 0, 0, 47, 2, 72, 1, 99, 0, 0, 6, 27, 41, 2, 1, 0, 0, 72, 72, 54, 8, 205, 0, 0, 0, 0, 0, 0, 0, 0
        // ];
        // const filter = [0.0625, 0.125, 0.0625, 0.125, 0.25, 0.125, 0.0625, 0.125, 0.0625]; 3*3 weighted avg filter
        // const filter = [0.0625, 0.125, 0.0625, 0.125, 0.25, 0.125, 0.0625, 0.125, 0.0625];

    </script>
</body>

</html>